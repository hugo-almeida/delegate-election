<div  ng-controller="voteCtrl">
	<div>
		<!-- Default panel contents -->
		<h3>Detalhes</h3>
		
		<!-- Table -->
		<table class="table">
			<tr>
				<th class="col-md-2">Curso</th>
				<td class="col-md-8 col-md-8-offset-4">{{degree.name}}</td>
			</tr>
			<tr>
				<th>Ano Lectivo</th>
				<td>{{degree.academicYear}}</td>
			</tr>
			<tr>
				<th>Candidaturas</th>
				<td>{{candidatos.length}}</td>
			</tr>
			<tr>
				<th>Período de votação</th>
				<td>{{degree.currentPeriod.start}} - {{degree.currentPeriod.end}}</td>
			</tr>
		</table>
	</div>
	
	<h3>Votação</h3>
	<div ng-show="loaded">
		<div class="container" ng-show="voted">
			<div class="alert alert-info alert-dismissible alert-floating" role="alert">
				<button type="button" class="close" data-dismiss="alert"><span class="sr-only">Close</span></button>
				<i class="glyphicon glyphicon-info-sign"></i><strong>   </strong> O teu voto já foi submetido.
			</div>
			<div class="panel panel-default" >
				<div class="panel-heading">Nome</div>
				<div class="table-responsive">
					<table class="table">
						<td class="col-md-1">
							<img ng-src="data:{{voto.photo.type}};base64,{{voto.photo.data}}" height="28" width="28">
						</td>
						<td ng-show="voto != 'null'">
							<strong>{{voto.name}}</strong>
							<small>{{voto.username}}</small>
						</td>
						<td ng-show="voto == 'null'">
							<strong>Voto em branco</strong>
						</td>
					</table>
				</div>
			</div>
		</div>
		
		<div class="panel panel-default" ng-show="voted==false"> <!-- table of candidates, shown if the user hasn't voted yet -->
			<div class="panel-heading">Nome</div>
			<div class="table-responsive">
				<table class="table"> 
					<tr ng-repeat="candidato in candidatos | orderBy:'username'">
						<td class="col-md-1">
							<input type="radio" ng-model="$parent.selected" value="{{candidato.username}}" name="voted"> <!-- $parent needed because ng-repeat creates its own scope -->
						</td>
						<td class="col-md-1">
							<img ng-src="data:{{candidato.photo.type}};base64,{{candidato.photo.data}}" height="28" width="28">
						</td>
						<td>
							<strong>{{candidato.name}}</strong>
							<small>{{candidato.username}}</small>
						</td>
					</tr>
					<tr>
						<td class="col-md-1">
							<input type="radio" ng-model="selected" value="nil" name="voted">
						</td>
						<td class="col-md-1">
						</td>
						<td>
							<strong>Votar em branco</strong>
						</td>
					</tr>
					<tr>
						<td>
							<input type="radio" ng-model="selected" value="other" name="voted" ng-change="loadStudents()">  
						</td>
						<td>
						</td>
						<td>
							<strong>Outro</strong>
							<small>Podes dar o teu voto a um aluno que não se candidatou {{search}}</small>
							<tr ng-show="selected == 'other'">
								<td>
								</td>
								<td>
								</td>
								<td>
									<!-- <span class="glyphicon glyphicon-search"></span>-->
									<input type="search" ng-model="query" ng-change="loadStudents(query)" ng-model-options="{ debounce: 300 }"></input>
									<table class="table">
										<tr ng-repeat="student in students | orderBy:'username'"  ng-hide="query==null || query==''">
											<td class="col-md-1">
												<input type="radio" name="otherVoted" ng-model="$parent.otherSelected" value="{{student.username}}">
											</td>
											<td class="col-md-1">
												<img ng-src="data:{{student.photo.type}};base64,{{student.photo.data}}" height="28" width="28">
											</td>	
											<td>	
												<strong>{{student.name}}</strong>
												<small>{{student.username}}</small>
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</td>
					</tr>
				</table>
			</div>
		</div>
		<button class="btn btn-primary" data-toggle="modal" data-target="#voteModal" ng-hide="voted" ng-click="selection()"
			ng-disabled="selected == '' || (selected == 'other' && (otherSelected == '' || otherSelected == null)) || selected == null">Votar</button>
	
		<div id="voteModal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h3>
							<strong>Confirmação de Voto</strong>
						</h3>
					    <button type="button" class="close" data-dismiss="modal"></button>
					</div>
					<div class="modal-body">
		        		<table class="table">
							<tr>
								<th class="col-md-6">Curso</th>
								<td class="col-md-12 col-md-12-offset-4">{{degree.name}}</td>
							</tr>
							<tr>
								<th>Ano Lectivo</th>
								<td>{{degree.academicYear}}</td>
							</tr>
							<tr>
								<th>Ano Curricular</th>
								<td>{{degree.curricularYear}}</td>
							</tr>
							<tr>
								<th>Período de votação</th>
								<td>{{degree.currentPeriod.start}} - {{degree.currentPeriod.end}}</td>
							</tr>
						</table>
						<p>
							Confirmar o seu voto em {{selectionResult}}?
						</p>
		      		</div>
		      		<div class="modal-footer">
		        			<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
		        			<button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="vote()">Confirmar</button>
		      		</div>
				</div>
			</div>
		</div>
		
		<div class="alert alert-success alert-dismissible alert-floating" style="position:absolute; top:60px; right:30px" role="alert" ng-show="feedback">
			<button type="button" class="close" data-dismiss="alert"><span class="sr-only">Close</span></button>
			<i class="icon icon-check"></i><strong>Submetido!</strong> O teu voto foi submetido com sucesso.
		</div>
	</div>
</div>

